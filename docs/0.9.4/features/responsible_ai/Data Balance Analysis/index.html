<!doctype html>
<html class="docs-version-0.9.4" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.14">
<link rel="alternate" type="application/rss+xml" href="/SynapseML/blog/rss.xml" title="SynapseML RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/SynapseML/blog/atom.xml" title="SynapseML Atom Feed">
<link rel="alternate" type="application/json" href="/SynapseML/blog/feed.json" title="SynapseML JSON Feed">
<link rel="search" type="application/opensearchdescription+xml" title="SynapseML" href="/SynapseML/opensearch.xml">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.11/dist/katex.min.css" integrity="sha384-Um5gpz1odJg5Z4HAmzPtgZKdTBHZdw8S29IecapCSB31ligYPhHQZMIlWLYQGVoc" crossorigin="anonymous"><title data-react-helmet="true">Data Balance Analysis on Spark | SynapseML</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:image" content="https://microsoft.github.io/SynapseML/img/synapseml_og.jpg"><meta data-react-helmet="true" name="twitter:image" content="https://microsoft.github.io/SynapseML/img/synapseml_og.jpg"><meta data-react-helmet="true" property="og:url" content="https://microsoft.github.io/SynapseML/docs/0.9.4/features/responsible_ai/Data Balance Analysis/"><meta data-react-helmet="true" name="docsearch:language" content="en"><meta data-react-helmet="true" name="docsearch:version" content="0.9.4"><meta data-react-helmet="true" name="docsearch:docusaurus_tag" content="docs-default-0.9.4"><meta data-react-helmet="true" property="og:title" content="Data Balance Analysis on Spark | SynapseML"><meta data-react-helmet="true" name="description" content="Learn how to do Data Balance Analysis on Spark to determine how well features and feature values are represented in your dataset."><meta data-react-helmet="true" property="og:description" content="Learn how to do Data Balance Analysis on Spark to determine how well features and feature values are represented in your dataset."><link data-react-helmet="true" rel="icon" href="/SynapseML/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://microsoft.github.io/SynapseML/docs/0.9.4/features/responsible_ai/Data Balance Analysis/"><link data-react-helmet="true" rel="alternate" href="https://microsoft.github.io/SynapseML/docs/0.9.4/features/responsible_ai/Data Balance Analysis/" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://microsoft.github.io/SynapseML/docs/0.9.4/features/responsible_ai/Data Balance Analysis/" hreflang="x-default"><link data-react-helmet="true" rel="preconnect" href="https://GBW8AA15RD-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="/SynapseML/assets/css/styles.074bcd8f.css">
<link rel="preload" href="/SynapseML/assets/js/runtime~main.dc11f221.js" as="script">
<link rel="preload" href="/SynapseML/assets/js/main.a6a41b46.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"dark")}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss")}catch(t){}return!1}())</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_1oUP">Skip to main content</a></div><div class="announcementBar_3WsW" role="banner"><div class="announcementBarPlaceholder_2m9F"></div><div class="announcementBarContent_3EUC">‚≠êÔ∏è If you like SynapseML, consider giving it a star on <a target="_blank" rel="noopener noreferrer" href="https://github.com/Microsoft/SynapseML">GitHub</a> ‚≠ê</div><button type="button" class="clean-btn close announcementBarClose_38nx" aria-label="Close"><svg viewBox="0 0 15 15" width="14" height="14"><g stroke="currentColor" stroke-width="3.1"><path d="M.75.75l13.5 13.5M14.25.75L.75 14.25"></path></g></svg></button></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/SynapseML/"><div class="navbar__logo"><img src="/SynapseML/img/logo.svg" alt="SynapseML Logo" class="themedImage_1VuW themedImage--light_3UqQ"><img src="/SynapseML/img/logo.svg" alt="SynapseML Logo" class="themedImage_1VuW themedImage--dark_hz6m"></div><b class="navbar__title">SynapseML</b></a><a class="navbar__item navbar__link" href="/SynapseML/docs/about/">Docs</a><a class="navbar__item navbar__link" href="/SynapseML/blog/">Blog</a><a class="navbar__item navbar__link" href="/SynapseML/videos/">Videos</a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a class="navbar__link" href="/SynapseML/docs/0.9.4/about/">0.9.4</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/SynapseML/docs/next/features/responsible_ai/Data Balance Analysis/">Next</a></li><li><a class="dropdown__link" href="/SynapseML/docs/features/responsible_ai/Data Balance Analysis/">0.9.5</a></li><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/SynapseML/docs/0.9.4/features/responsible_ai/Data Balance Analysis/">0.9.4</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" class="navbar__link"><span><svg viewBox="0 0 20 20" width="20" height="20" aria-hidden="true" class="iconLanguage_3vod"><path fill="currentColor" d="M19.753 10.909c-.624-1.707-2.366-2.726-4.661-2.726-.09 0-.176.002-.262.006l-.016-2.063 3.525-.607c.115-.019.133-.119.109-.231-.023-.111-.167-.883-.188-.976-.027-.131-.102-.127-.207-.109-.104.018-3.25.461-3.25.461l-.013-2.078c-.001-.125-.069-.158-.194-.156l-1.025.016c-.105.002-.164.049-.162.148l.033 2.307s-3.061.527-3.144.543c-.084.014-.17.053-.151.143.019.09.19 1.094.208 1.172.018.08.072.129.188.107l2.924-.504.035 2.018c-1.077.281-1.801.824-2.256 1.303-.768.807-1.207 1.887-1.207 2.963 0 1.586.971 2.529 2.328 2.695 3.162.387 5.119-3.06 5.769-4.715 1.097 1.506.256 4.354-2.094 5.98-.043.029-.098.129-.033.207l.619.756c.08.096.206.059.256.023 2.51-1.73 3.661-4.515 2.869-6.683zm-7.386 3.188c-.966-.121-.944-.914-.944-1.453 0-.773.327-1.58.876-2.156a3.21 3.21 0 011.229-.799l.082 4.277a2.773 2.773 0 01-1.243.131zm2.427-.553l.046-4.109c.084-.004.166-.01.252-.01.773 0 1.494.145 1.885.361.391.217-1.023 2.713-2.183 3.758zm-8.95-7.668a.196.196 0 00-.196-.145h-1.95a.194.194 0 00-.194.144L.008 16.916c-.017.051-.011.076.062.076h1.733c.075 0 .099-.023.114-.072l1.008-3.318h3.496l1.008 3.318c.016.049.039.072.113.072h1.734c.072 0 .078-.025.062-.076-.014-.05-3.083-9.741-3.494-11.04zm-2.618 6.318l1.447-5.25 1.447 5.25H3.226z"></path></svg><span>English</span></span></a><ul class="dropdown__menu"><li><a href="/SynapseML/docs/0.9.4/features/responsible_ai/Data Balance Analysis/" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active">English</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" class="navbar__link">Developer Docs</a><ul class="dropdown__menu"><li><a href="https://mmlspark.blob.core.windows.net/docs/0.9.5/pyspark/index.html" target="_blank" rel="noopener noreferrer" class="dropdown__link"><span>Python<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li><a href="https://mmlspark.blob.core.windows.net/docs/0.9.5/scala/com/microsoft/azure/synapse/ml/index.html" target="_blank" rel="noopener noreferrer" class="dropdown__link"><span>Scala<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><a href="https://github.com/microsoft/SynapseML" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link" aria-label="GitHub repository"></a><div class="toggle_71bT toggle_3Zt9 toggleChecked_2FvV toggleDisabled_3cF-"><div class="toggleTrack_32Fl" role="button" tabindex="-1"><div class="toggleTrackCheck_3lV7"><span class="toggleIcon_O4iE">üåú</span></div><div class="toggleTrackX_S2yS"><span class="toggleIcon_O4iE">üåû</span></div><div class="toggleTrackThumb_xI_Z"></div></div><input type="checkbox" checked="" class="toggleScreenReader_28Tw" aria-label="Switch between dark and light mode"></div><div class="searchBox_1Kl_"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_31aa"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_35hR" type="button"></button><aside class="docSidebarContainer_3Kbt"><div class="sidebar_15mo"><nav class="menu thin-scrollbar menu_Bmed menuWithAnnouncementBar_2WvA"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/SynapseML/docs/0.9.4/about/">Introduction</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_2fq0" href="/SynapseML/docs/0.9.4/getting_started/installation/">Getting Started</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active hasHref_2fq0" href="/SynapseML/docs/0.9.4/features/cognitive_services/CognitiveServices - Celebrity Quote Analysis/">Features</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_2fq0" tabindex="0" href="/SynapseML/docs/0.9.4/features/cognitive_services/CognitiveServices - Celebrity Quote Analysis/">Cognitive Services</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active hasHref_2fq0" tabindex="0" href="/SynapseML/docs/0.9.4/features/responsible_ai/Data Balance Analysis/">Responsible AI</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/SynapseML/docs/0.9.4/features/responsible_ai/Data Balance Analysis/">Data Balance Analysis</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/SynapseML/docs/0.9.4/features/responsible_ai/DataBalanceAnalysis - Adult Census Income/">DataBalanceAnalysis - Adult Census Income</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/SynapseML/docs/0.9.4/features/responsible_ai/Interpretability - Explanation Dashboard/">Interpretability - Explanation Dashboard</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/SynapseML/docs/0.9.4/features/responsible_ai/Interpretability - Image Explainers/">Interpretability - Image Explainers</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/SynapseML/docs/0.9.4/features/responsible_ai/Interpretability - Snow Leopard Detection/">Interpretability - Snow Leopard Detection</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/SynapseML/docs/0.9.4/features/responsible_ai/Interpretability - Tabular SHAP explainer/">Interpretability - Tabular SHAP explainer</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/SynapseML/docs/0.9.4/features/responsible_ai/Interpretability - Text Explainers/">Interpretability - Text Explainers</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/SynapseML/docs/0.9.4/features/responsible_ai/Model Interpretation on Spark/">Model Interpretation on Spark</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_2fq0" tabindex="0" href="/SynapseML/docs/0.9.4/features/onnx/about/">ONNX</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_2fq0" tabindex="0" href="/SynapseML/docs/0.9.4/features/lightgbm/about/">LightGBM</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_2fq0" tabindex="0" href="/SynapseML/docs/0.9.4/features/vw/about/">Vowpal Wabbit</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_2fq0" tabindex="0" href="/SynapseML/docs/0.9.4/features/spark_serving/about/">Spark Serving</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_2fq0" tabindex="0" href="/SynapseML/docs/0.9.4/features/opencv/OpenCV - Pipeline Image Transformations/">OpenCV</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_2fq0" tabindex="0" href="/SynapseML/docs/0.9.4/features/classification/Classification - Adult Census with Vowpal Wabbit/">Classification</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_2fq0" tabindex="0" href="/SynapseML/docs/0.9.4/features/regression/Regression - Auto Imports/">Regression</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_2fq0" tabindex="0" href="/SynapseML/docs/0.9.4/features/other/AzureSearchIndex - Met Artworks/">Other</a></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_2fq0" href="/SynapseML/docs/0.9.4/documentation/transformers/transformers_cognitive/">Transformers</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_2fq0" href="/SynapseML/docs/0.9.4/documentation/estimators/estimators_core/">Estimators</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_2fq0" href="/SynapseML/docs/0.9.4/reference/developer-readme/">Reference</a></div></li></ul></nav></div></aside><main class="docMainContainer_3ufF"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_3FnS"><div class="theme-doc-version-banner alert alert--warning margin-bottom--md" role="alert"><div>This is documentation for <!-- -->SynapseML<!-- --> <b>0.9.4</b>, which is no longer actively maintained.</div><div class="margin-top--md">For up-to-date documentation, see the <b><a href="/SynapseML/docs/features/responsible_ai/Data Balance Analysis/">latest version</a></b> (<!-- -->0.9.5<!-- -->).</div></div><div class="docItemContainer_33ec"><article><span class="theme-doc-version-badge badge badge--secondary">Version: <!-- -->0.9.4</span><div class="tocCollapsible_1PrD theme-doc-toc-mobile tocMobile_3Hoh"><button type="button" class="clean-btn tocCollapsibleButton_2O1e">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Data Balance Analysis on Spark</h1></header><h2 class="anchor anchorWithStickyNavbar_31ik" id="context">Context<a class="hash-link" href="#context" title="Direct link to heading">‚Äã</a></h2><p>Data Balance Analysis is relevant for overall understanding of datasets, but it becomes essential when thinking about building Machine Learning services out of such datasets. Having a well balanced data representation is critical when developing models in a responsible way, specially in terms of fairness.
It is unfortunately all too easy to build an ML model that produces biased results for subsets of an overall population, by training or testing the model on biased ground truth data. There are multiple case studies of biased models assisting in granting loans, healthcare, recruitment opportunities and many other decision making tasks. In most of these examples, the data from which these models are trained was the common issue. These findings emphasize how important it is for model creators and auditors to analyze data balance: to measure training data across sub-populations and ensure the data has good coverage and a balanced representation of labels across sensitive categories and category combinations, and to check that test data is representative of the target population.</p><p>In summary, Data Balance Analysis, used as a step for building ML models has the following benefits:</p><ul><li><strong>Reduces risks for unbalanced models (facilitate service fairness) and reduces costs of ML building</strong> by identifying early on data representation gaps that prompt data scientists to seek mitigation steps (collect more data, follow a specific sampling mechanism, create synthetic data, etc.) before proceeding to train their models.</li><li><strong>Enables easy e2e debugging of ML systems</strong> in combination with <a href="https://fairlearn.org/" target="_blank" rel="noopener noreferrer">Fairlearn</a> by providing a clear view if for an unbalanced model the issue is tied to the data or the model.</li></ul><h2 class="anchor anchorWithStickyNavbar_31ik" id="examples">Examples<a class="hash-link" href="#examples" title="Direct link to heading">‚Äã</a></h2><ul><li><a href="/SynapseML/docs/0.9.4/features/responsible_ai/DataBalanceAnalysis - Adult Census Income/">Data Balance Analysis - Adult Census Income</a></li></ul><h2 class="anchor anchorWithStickyNavbar_31ik" id="usage">Usage<a class="hash-link" href="#usage" title="Direct link to heading">‚Äã</a></h2><p>Data Balance Analysis currently supports three transformers in the <code>synapse.ml.exploratory</code> namespace:</p><ul><li>FeatureBalanceMeasure - supervised (requires label column)</li><li>DistributionBalanceMeasure - unsupervised (doesn&#x27;t require label column)</li><li>AggregateBalanceMeasure - unsupervised (doesn&#x27;t require label column)</li></ul><ol><li><p>Import all three transformers.</p><p>For example:</p><div class="codeBlockContainer_K1bP language-python theme-code-block"><div class="codeBlockContent_hGly python"><pre tabindex="0" class="prism-code language-python codeBlock_23N8 thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#f8f8f2"><span class="token keyword">from</span><span class="token plain"> synapse</span><span class="token punctuation" style="color:rgb(249, 38, 114)">.</span><span class="token plain">ml</span><span class="token punctuation" style="color:rgb(249, 38, 114)">.</span><span class="token plain">exploratory </span><span class="token keyword">import</span><span class="token plain"> AggregateBalanceMeasure</span><span class="token punctuation" style="color:rgb(249, 38, 114)">,</span><span class="token plain"> DistributionBalanceMeasure</span><span class="token punctuation" style="color:rgb(249, 38, 114)">,</span><span class="token plain"> FeatureBalanceMeasure</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div></li><li><p>Load your dataset, define features of interest, and ensure that the label column is binary. The <code>FeatureBalanceMeasure</code> transformer currently only supports binary labels, but support for numerical labels will be added soon.</p><p>For example:</p><div class="codeBlockContainer_K1bP language-python theme-code-block"><div class="codeBlockContent_hGly python"><pre tabindex="0" class="prism-code language-python codeBlock_23N8 thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#f8f8f2"><span class="token keyword">import</span><span class="token plain"> pyspark</span><span class="token punctuation" style="color:rgb(249, 38, 114)">.</span><span class="token plain">sql</span><span class="token punctuation" style="color:rgb(249, 38, 114)">.</span><span class="token plain">functions </span><span class="token keyword">as</span><span class="token plain"> F</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">features </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(249, 38, 114)">[</span><span class="token string" style="color:rgb(230, 219, 116)">&quot;race&quot;</span><span class="token punctuation" style="color:rgb(249, 38, 114)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(230, 219, 116)">&quot;sex&quot;</span><span class="token punctuation" style="color:rgb(249, 38, 114)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">label </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(230, 219, 116)">&quot;income&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">df </span><span class="token operator">=</span><span class="token plain"> spark</span><span class="token punctuation" style="color:rgb(249, 38, 114)">.</span><span class="token plain">read</span><span class="token punctuation" style="color:rgb(249, 38, 114)">.</span><span class="token plain">parquet</span><span class="token punctuation" style="color:rgb(249, 38, 114)">(</span><span class="token string" style="color:rgb(230, 219, 116)">&quot;wasbs://publicwasb@mmlspark.blob.core.windows.net/AdultCensusIncome.parquet&quot;</span><span class="token punctuation" style="color:rgb(249, 38, 114)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token comment" style="color:rgb(136, 132, 111)"># Convert the &quot;income&quot; column from {&lt;=50K, &gt;50K} to {0, 1} to represent our binary classification label column</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">df </span><span class="token operator">=</span><span class="token plain"> df</span><span class="token punctuation" style="color:rgb(249, 38, 114)">.</span><span class="token plain">withColumn</span><span class="token punctuation" style="color:rgb(249, 38, 114)">(</span><span class="token plain">label</span><span class="token punctuation" style="color:rgb(249, 38, 114)">,</span><span class="token plain"> F</span><span class="token punctuation" style="color:rgb(249, 38, 114)">.</span><span class="token plain">when</span><span class="token punctuation" style="color:rgb(249, 38, 114)">(</span><span class="token plain">F</span><span class="token punctuation" style="color:rgb(249, 38, 114)">.</span><span class="token plain">col</span><span class="token punctuation" style="color:rgb(249, 38, 114)">(</span><span class="token plain">label</span><span class="token punctuation" style="color:rgb(249, 38, 114)">)</span><span class="token punctuation" style="color:rgb(249, 38, 114)">.</span><span class="token plain">contains</span><span class="token punctuation" style="color:rgb(249, 38, 114)">(</span><span class="token string" style="color:rgb(230, 219, 116)">&quot;&lt;=50K&quot;</span><span class="token punctuation" style="color:rgb(249, 38, 114)">)</span><span class="token punctuation" style="color:rgb(249, 38, 114)">,</span><span class="token plain"> F</span><span class="token punctuation" style="color:rgb(249, 38, 114)">.</span><span class="token plain">lit</span><span class="token punctuation" style="color:rgb(249, 38, 114)">(</span><span class="token number" style="color:rgb(174, 129, 255)">0</span><span class="token punctuation" style="color:rgb(249, 38, 114)">)</span><span class="token punctuation" style="color:rgb(249, 38, 114)">)</span><span class="token punctuation" style="color:rgb(249, 38, 114)">.</span><span class="token plain">otherwise</span><span class="token punctuation" style="color:rgb(249, 38, 114)">(</span><span class="token plain">F</span><span class="token punctuation" style="color:rgb(249, 38, 114)">.</span><span class="token plain">lit</span><span class="token punctuation" style="color:rgb(249, 38, 114)">(</span><span class="token number" style="color:rgb(174, 129, 255)">1</span><span class="token punctuation" style="color:rgb(249, 38, 114)">)</span><span class="token punctuation" style="color:rgb(249, 38, 114)">)</span><span class="token punctuation" style="color:rgb(249, 38, 114)">)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div></li><li><p>Create a <code>FeatureBalanceMeasure</code> transformer and call <code>setSensitiveCols</code> to set the list of sensitive features and call <code>setLabelCol</code> to set the binary label column. Then, call the <code>transform</code> method with your dataset and visualize the resulting dataframe.</p><p>For example:</p><div class="codeBlockContainer_K1bP language-python theme-code-block"><div class="codeBlockContent_hGly python"><pre tabindex="0" class="prism-code language-python codeBlock_23N8 thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#f8f8f2"><span class="token plain">feature_balance_measures </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(249, 38, 114)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    FeatureBalanceMeasure</span><span class="token punctuation" style="color:rgb(249, 38, 114)">(</span><span class="token punctuation" style="color:rgb(249, 38, 114)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(249, 38, 114)">.</span><span class="token plain">setSensitiveCols</span><span class="token punctuation" style="color:rgb(249, 38, 114)">(</span><span class="token plain">features</span><span class="token punctuation" style="color:rgb(249, 38, 114)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(249, 38, 114)">.</span><span class="token plain">setLabelCol</span><span class="token punctuation" style="color:rgb(249, 38, 114)">(</span><span class="token plain">label</span><span class="token punctuation" style="color:rgb(249, 38, 114)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(249, 38, 114)">.</span><span class="token plain">transform</span><span class="token punctuation" style="color:rgb(249, 38, 114)">(</span><span class="token plain">df</span><span class="token punctuation" style="color:rgb(249, 38, 114)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(249, 38, 114)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">feature_balance_measures</span><span class="token punctuation" style="color:rgb(249, 38, 114)">.</span><span class="token plain">show</span><span class="token punctuation" style="color:rgb(249, 38, 114)">(</span><span class="token plain">truncate</span><span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation" style="color:rgb(249, 38, 114)">)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div></li><li><p>Create a <code>DistributionBalanceMeasure</code> transformer and and call <code>setSensitiveCols</code> to set the list of sensitive features. Then, call the <code>transform</code> method with your dataset and visualize the resulting dataframe.</p><p>For example:</p><div class="codeBlockContainer_K1bP language-python theme-code-block"><div class="codeBlockContent_hGly python"><pre tabindex="0" class="prism-code language-python codeBlock_23N8 thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#f8f8f2"><span class="token plain">distribution_balance_measures </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(249, 38, 114)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    DistributionBalanceMeasure</span><span class="token punctuation" style="color:rgb(249, 38, 114)">(</span><span class="token punctuation" style="color:rgb(249, 38, 114)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(249, 38, 114)">.</span><span class="token plain">setSensitiveCols</span><span class="token punctuation" style="color:rgb(249, 38, 114)">(</span><span class="token plain">features</span><span class="token punctuation" style="color:rgb(249, 38, 114)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(249, 38, 114)">.</span><span class="token plain">transform</span><span class="token punctuation" style="color:rgb(249, 38, 114)">(</span><span class="token plain">df</span><span class="token punctuation" style="color:rgb(249, 38, 114)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(249, 38, 114)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">distribution_balance_measures</span><span class="token punctuation" style="color:rgb(249, 38, 114)">.</span><span class="token plain">show</span><span class="token punctuation" style="color:rgb(249, 38, 114)">(</span><span class="token plain">truncate</span><span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation" style="color:rgb(249, 38, 114)">)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div></li><li><p>Create a <code>AggregateBalanceMeasure</code> transformer and and call <code>setSensitiveCols</code> to set the list of sensitive features. Then, call the <code>transform</code> method with your dataset and visualize the resulting dataframe.</p><p>For example:</p><div class="codeBlockContainer_K1bP language-python theme-code-block"><div class="codeBlockContent_hGly python"><pre tabindex="0" class="prism-code language-python codeBlock_23N8 thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#f8f8f2"><span class="token plain">aggregate_balance_measures </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(249, 38, 114)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    AggregateBalanceMeasure</span><span class="token punctuation" style="color:rgb(249, 38, 114)">(</span><span class="token punctuation" style="color:rgb(249, 38, 114)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(249, 38, 114)">.</span><span class="token plain">setSensitiveCols</span><span class="token punctuation" style="color:rgb(249, 38, 114)">(</span><span class="token plain">features</span><span class="token punctuation" style="color:rgb(249, 38, 114)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(249, 38, 114)">.</span><span class="token plain">transform</span><span class="token punctuation" style="color:rgb(249, 38, 114)">(</span><span class="token plain">df</span><span class="token punctuation" style="color:rgb(249, 38, 114)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(249, 38, 114)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">aggregate_balance_measures</span><span class="token punctuation" style="color:rgb(249, 38, 114)">.</span><span class="token plain">show</span><span class="token punctuation" style="color:rgb(249, 38, 114)">(</span><span class="token plain">truncate</span><span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation" style="color:rgb(249, 38, 114)">)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div></li></ol><p>Note: If you are running this notebook in a Spark environment such as Azure Synapse or Databricks, then you can easily visualize the imbalance measures by calling the built-in plotting features <code>display()</code>.</p><h2 class="anchor anchorWithStickyNavbar_31ik" id="measure-explanations">Measure Explanations<a class="hash-link" href="#measure-explanations" title="Direct link to heading">‚Äã</a></h2><h3 class="anchor anchorWithStickyNavbar_31ik" id="feature-balance-measures">Feature Balance Measures<a class="hash-link" href="#feature-balance-measures" title="Direct link to heading">‚Äã</a></h3><p>Feature Balance Measures allow us to see whether each combination of sensitive feature is receiving the positive outcome (true prediction) at balanced probability.</p><p>In this context, we define a feature balance measure, also referred to as the parity, for label y as the difference between the association metrics of two different sensitive classes <!-- -->\<!-- -->(<!-- -->[x_A, x_B]<!-- -->\<!-- -->), with respect to the association metric <!-- -->\<!-- -->(A(x_i, y)<!-- -->\<!-- -->). That is:</p><p>$<span class="math math-inline"><span class="katex-error" title="ParseError: KaTeX parse error: Can&#x27;t use function &#x27;$&#x27; in math mode at position 68: ‚Ä¶y) - A(x_B, y) $Ã≤" style="color:#cc0000">parity(y \vert x_A, x_B, A(\cdot)) \coloneqq A(x_A, y) - A(x_B, y) $</span></span></p><p>Using the dataset, we can see if the various sexes and races are receiving &gt;50k income at equal or unequal rates.</p><p>Note: Many of these metrics were influenced by this paper <a href="https://arxiv.org/abs/2103.03417" target="_blank" rel="noopener noreferrer">Measuring Model Biases in the Absence of Ground Truth</a>.</p><table><thead><tr><th>Association Metric</th><th>Family</th><th>Description</th><th>Interpretation/Formula</th><th>Reference</th></tr></thead><tbody><tr><td>Demographic Parity</td><td>Fairness</td><td>Proportion of each segment of a protected class (e.g. gender) should receive the positive outcome at equal rates.</td><td>As close to 0 means better parity. <!-- -->\<!-- -->(DP = P(Y \vert A = &quot;Male&quot;) - P(Y \vert A = &quot;Female&quot;)<!-- -->\<!-- -->). Y = Positive label rate.</td><td><a href="https://en.wikipedia.org/wiki/Fairness_%28machine_learning%29" target="_blank" rel="noopener noreferrer">Link</a></td></tr><tr><td>Pointwise Mutual Information (PMI), normalized PMI</td><td>Entropy</td><td>The PMI of a pair of feature values (ex: Gender=Male and Gender=Female) quantifies the discrepancy between the probability of their coincidence given their joint distribution and their individual distributions (assuming independence).</td><td>Range (normalized) <!-- -->[-1, 1]<!-- -->. -1 for no co-occurences. 0 for co-occurences at random. 1 for complete co-occurences.</td><td><a href="https://en.wikipedia.org/wiki/Pointwise_mutual_information" target="_blank" rel="noopener noreferrer">Link</a></td></tr><tr><td>Sorensen-Dice Coefficient (SDC)</td><td>Intersection-over-Union</td><td>Used to gauge the similarity of two samples. Related to F1 score.</td><td>Equals twice the number of elements common to both sets divided by the sum of the number of elements in each set.</td><td><a href="https://en.wikipedia.org/wiki/S%C3%B8rensen%E2%80%93Dice_coefficient" target="_blank" rel="noopener noreferrer">Link</a></td></tr><tr><td>Jaccard Index</td><td>Intersection-over-Union</td><td>Similar to SDC, guages the similarity and diversity of sample sets.</td><td>Equals the size of the intersection divided by the size of the union of the sample sets.</td><td><a href="https://en.wikipedia.org/wiki/Jaccard_index" target="_blank" rel="noopener noreferrer">Link</a></td></tr><tr><td>Kendall Rank Correlation</td><td>Correlation and Statistical Tests</td><td>Used to measure the ordinal association between two measured quantities.</td><td>High when observations have a similar rank and low when observations have a dissimilar rank between the two variables.</td><td><a href="https://en.wikipedia.org/wiki/Kendall_rank_correlation_coefficient" target="_blank" rel="noopener noreferrer">Link</a></td></tr><tr><td>Log-Likelihood Ratio</td><td>Correlation and Statistical Tests</td><td>Calculates the degree to which data supports one variable versus another. Log of the likelihood ratio, which gives the probability of correctly predicting the label in ratio to probability of incorrectly predicting label.</td><td>If likelihoods are similar, it should be close to 0.</td><td><a href="https://en.wikipedia.org/wiki/Likelihood_function#Likelihood_ratio" target="_blank" rel="noopener noreferrer">Link</a></td></tr><tr><td>t-test</td><td>Correlation and Statistical Tests</td><td>Used to compare the means of two groups (pairwise).</td><td>Value looked up in t-Distribution tell if statistically significant or not.</td><td><a href="https://en.wikipedia.org/wiki/Student&#x27;s_t-test" target="_blank" rel="noopener noreferrer">Link</a></td></tr></tbody></table><h3 class="anchor anchorWithStickyNavbar_31ik" id="distribution-balance-measures">Distribution Balance Measures<a class="hash-link" href="#distribution-balance-measures" title="Direct link to heading">‚Äã</a></h3><p>Distribution Balance Measures allow us to compare our data with a reference distribution (currently only uniform distribution is supported as a reference distribution). They are calculated per sensitive column and do not depend on the label column.</p><p>For example, let&#x27;s assume we have a dataset with 9 rows and a Gender column, and we observe that:</p><ul><li>&quot;Male&quot; appears 4 times</li><li>&quot;Female&quot; appears 3 times</li><li>&quot;Other&quot; appears 2 times</li></ul><p>Assuming the uniform distribution:
<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>R</mi><mi>e</mi><mi>f</mi><mi>e</mi><mi>r</mi><mi>e</mi><mi>n</mi><mi>c</mi><mi>e</mi><mi>C</mi><mi>o</mi><mi>u</mi><mi>n</mi><mi>t</mi><mo><mi mathvariant="normal">‚âî</mi></mo><mfrac><mrow><mi>n</mi><mi>u</mi><mi>m</mi><mi>R</mi><mi>o</mi><mi>w</mi><mi>s</mi></mrow><mrow><mi>n</mi><mi>u</mi><mi>m</mi><mi>F</mi><mi>e</mi><mi>a</mi><mi>t</mi><mi>u</mi><mi>r</mi><mi>e</mi><mi>V</mi><mi>a</mi><mi>l</mi><mi>u</mi><mi>e</mi><mi>s</mi></mrow></mfrac></mrow><annotation encoding="application/x-tex">ReferenceCount \coloneqq \frac{numRows}{numFeatureValues}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em"></span><span class="mord mathnormal" style="margin-right:0.00773em">R</span><span class="mord mathnormal">e</span><span class="mord mathnormal" style="margin-right:0.10764em">f</span><span class="mord mathnormal">e</span><span class="mord mathnormal" style="margin-right:0.02778em">r</span><span class="mord mathnormal">e</span><span class="mord mathnormal">n</span><span class="mord mathnormal">c</span><span class="mord mathnormal">e</span><span class="mord mathnormal" style="margin-right:0.07153em">C</span><span class="mord mathnormal">o</span><span class="mord mathnormal">u</span><span class="mord mathnormal">n</span><span class="mord mathnormal">t</span><span class="mspace" style="margin-right:0.2777777777777778em"></span><span class="mrel"><span class="mrel"><span class="mop" style="position:relative;top:-0.03472em">:</span></span><span class="mrel"><span class="mspace" style="margin-right:-0.06666666666666667em"></span></span><span class="mrel">=</span></span><span class="mspace" style="margin-right:0.2777777777777778em"></span></span><span class="base"><span class="strut" style="height:1.217331em;vertical-align:-0.345em"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.872331em"><span style="top:-2.6550000000000002em"><span class="pstrut" style="height:3em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span><span class="mord mathnormal mtight">u</span><span class="mord mathnormal mtight">m</span><span class="mord mathnormal mtight" style="margin-right:0.13889em">F</span><span class="mord mathnormal mtight">e</span><span class="mord mathnormal mtight">a</span><span class="mord mathnormal mtight">t</span><span class="mord mathnormal mtight">u</span><span class="mord mathnormal mtight" style="margin-right:0.02778em">r</span><span class="mord mathnormal mtight">e</span><span class="mord mathnormal mtight" style="margin-right:0.22222em">V</span><span class="mord mathnormal mtight">a</span><span class="mord mathnormal mtight" style="margin-right:0.01968em">l</span><span class="mord mathnormal mtight">u</span><span class="mord mathnormal mtight">e</span><span class="mord mathnormal mtight">s</span></span></span></span><span style="top:-3.23em"><span class="pstrut" style="height:3em"></span><span class="frac-line" style="border-bottom-width:0.04em"></span></span><span style="top:-3.394em"><span class="pstrut" style="height:3em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span><span class="mord mathnormal mtight">u</span><span class="mord mathnormal mtight">m</span><span class="mord mathnormal mtight" style="margin-right:0.00773em">R</span><span class="mord mathnormal mtight">o</span><span class="mord mathnormal mtight" style="margin-right:0.02691em">w</span><span class="mord mathnormal mtight">s</span></span></span></span></span><span class="vlist-s">‚Äã</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span>
<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>R</mi><mi>e</mi><mi>f</mi><mi>e</mi><mi>r</mi><mi>e</mi><mi>n</mi><mi>c</mi><mi>e</mi><mi>P</mi><mi>r</mi><mi>o</mi><mi>b</mi><mi>a</mi><mi>b</mi><mi>i</mi><mi>l</mi><mi>i</mi><mi>t</mi><mi>y</mi><mo><mi mathvariant="normal">‚âî</mi></mo><mfrac><mn>1</mn><mrow><mi>n</mi><mi>u</mi><mi>m</mi><mi>F</mi><mi>e</mi><mi>a</mi><mi>t</mi><mi>u</mi><mi>r</mi><mi>e</mi><mi>V</mi><mi>a</mi><mi>l</mi><mi>u</mi><mi>e</mi><mi>s</mi></mrow></mfrac></mrow><annotation encoding="application/x-tex">ReferenceProbability \coloneqq \frac{1}{numFeatureValues}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em"></span><span class="mord mathnormal" style="margin-right:0.00773em">R</span><span class="mord mathnormal">e</span><span class="mord mathnormal" style="margin-right:0.10764em">f</span><span class="mord mathnormal">e</span><span class="mord mathnormal" style="margin-right:0.02778em">r</span><span class="mord mathnormal">e</span><span class="mord mathnormal">n</span><span class="mord mathnormal">c</span><span class="mord mathnormal">e</span><span class="mord mathnormal" style="margin-right:0.13889em">P</span><span class="mord mathnormal" style="margin-right:0.02778em">r</span><span class="mord mathnormal">o</span><span class="mord mathnormal">b</span><span class="mord mathnormal">a</span><span class="mord mathnormal">b</span><span class="mord mathnormal">i</span><span class="mord mathnormal" style="margin-right:0.01968em">l</span><span class="mord mathnormal">i</span><span class="mord mathnormal">t</span><span class="mord mathnormal" style="margin-right:0.03588em">y</span><span class="mspace" style="margin-right:0.2777777777777778em"></span><span class="mrel"><span class="mrel"><span class="mop" style="position:relative;top:-0.03472em">:</span></span><span class="mrel"><span class="mspace" style="margin-right:-0.06666666666666667em"></span></span><span class="mrel">=</span></span><span class="mspace" style="margin-right:0.2777777777777778em"></span></span><span class="base"><span class="strut" style="height:1.190108em;vertical-align:-0.345em"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.845108em"><span style="top:-2.6550000000000002em"><span class="pstrut" style="height:3em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span><span class="mord mathnormal mtight">u</span><span class="mord mathnormal mtight">m</span><span class="mord mathnormal mtight" style="margin-right:0.13889em">F</span><span class="mord mathnormal mtight">e</span><span class="mord mathnormal mtight">a</span><span class="mord mathnormal mtight">t</span><span class="mord mathnormal mtight">u</span><span class="mord mathnormal mtight" style="margin-right:0.02778em">r</span><span class="mord mathnormal mtight">e</span><span class="mord mathnormal mtight" style="margin-right:0.22222em">V</span><span class="mord mathnormal mtight">a</span><span class="mord mathnormal mtight" style="margin-right:0.01968em">l</span><span class="mord mathnormal mtight">u</span><span class="mord mathnormal mtight">e</span><span class="mord mathnormal mtight">s</span></span></span></span><span style="top:-3.23em"><span class="pstrut" style="height:3em"></span><span class="frac-line" style="border-bottom-width:0.04em"></span></span><span style="top:-3.394em"><span class="pstrut" style="height:3em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">‚Äã</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></p><table><thead><tr><th>Feature Value</th><th>Observed Count</th><th>Reference Count</th><th>Observed Probability</th><th>Reference Probabiliy</th></tr></thead><tbody><tr><td>Male</td><td>4</td><td>9/3 = 3</td><td>4/9 = 0.44</td><td>3/9 = 0.33</td></tr><tr><td>Female</td><td>3</td><td>9/3 = 3</td><td>3/9 = 0.33</td><td>3/9 = 0.33</td></tr><tr><td>Other</td><td>2</td><td>9/3 = 3</td><td>2/9 = 0.22</td><td>3/9 = 0.33</td></tr></tbody></table><p>We can use distance measures to find out how far our observed and reference distributions of these feature values are. Some of these distance measures include:</p><table><thead><tr><th>Measure</th><th>Description</th><th>Interpretation</th><th>Reference</th></tr></thead><tbody><tr><td>KL Divergence</td><td>Measure of how one probability distribution is different from a second, reference probability distribution. Measure of the information gained when one revises one&#x27;s beliefs from the prior probability distribution Q to the posterior probability distribution P. In other words, it is the amount of information lost when Q is used to approximate P.</td><td>Non-negative. 0 means P = Q.</td><td><a href="https://en.wikipedia.org/wiki/Kullback%E2%80%93Leibler_divergence" target="_blank" rel="noopener noreferrer">Link</a></td></tr><tr><td>JS Distance</td><td>Measuring the similarity between two probability distributions. Symmetrized and smoothed version of the Kullback‚ÄìLeibler (KL) divergence. Square root of JS Divergence.</td><td>Range <!-- -->[0, 1]<!-- -->. 0 means perfectly same to balanced distribution.</td><td><a href="https://en.wikipedia.org/wiki/Jensen%E2%80%93Shannon_divergence" target="_blank" rel="noopener noreferrer">Link</a></td></tr><tr><td>Wasserstein Distance</td><td>This distance is also known as the earth mover‚Äôs distance, since it can be seen as the minimum amount of ‚Äúwork‚Äù required to transform u into v, where ‚Äúwork‚Äù is measured as the amount of distribution weight that must be moved, multiplied by the distance it has to be moved.</td><td>Non-negative. 0 means P = Q.</td><td><a href="https://en.wikipedia.org/wiki/Wasserstein_metric" target="_blank" rel="noopener noreferrer">Link</a></td></tr><tr><td>Infinity Norm Distance</td><td>Distance between two vectors is the greatest of their differences along any coordinate dimension. Also called Chebyshev distance or chessboard distance.</td><td>Non-negative. 0 means same distribution.</td><td><a href="https://en.wikipedia.org/wiki/Chebyshev_distance" target="_blank" rel="noopener noreferrer">Link</a></td></tr><tr><td>Total Variation Distance</td><td>It is equal to half the L1 (Manhattan) distance between the two distributions. Take the difference between the two proportions in each category, add up the absolute values of all the differences, and then divide the sum by 2.</td><td>Non-negative. 0 means same distribution.</td><td><a href="https://en.wikipedia.org/wiki/Total_variation_distance_of_probability_measures" target="_blank" rel="noopener noreferrer">Link</a></td></tr><tr><td>Chi-Squared Test</td><td>The chi-square test tests the null hypothesis that the categorical data has the given frequencies given expected frequencies in each category.</td><td>p-value gives evidence against null-hypothesis that difference in observed and expected frequencies is by random chance.</td><td><a href="https://en.wikipedia.org/wiki/Chi-squared_test" target="_blank" rel="noopener noreferrer">Link</a></td></tr></tbody></table><h3 class="anchor anchorWithStickyNavbar_31ik" id="aggregate-balance-measures">Aggregate Balance Measures<a class="hash-link" href="#aggregate-balance-measures" title="Direct link to heading">‚Äã</a></h3><p>Aggregate Balance Measures allow us to obtain a higher notion of inequality. They are calculated on the set of all sensitive columns and do not depend on the label column.</p><p>These measures look at distribution of records across all combinations of sensitive columns. For example, if Sex and Race are specified as sensitive features, it then tries to quantify imbalance across all combinations of the two specified features - (Male, Black), (Female, White), (Male, Asian-Pac-Islander), etc.</p><table><thead><tr><th>Measure</th><th>Description</th><th>Interpretation</th><th>Reference</th></tr></thead><tbody><tr><td>Atkinson Index</td><td>It presents the percentage of total income that a given society would have to forego in order to have more equal shares of income between its citizens. This measure depends on the degree of society aversion to inequality (a theoretical parameter decided by the researcher), where a higher value entails greater social utility or willingness by individuals to accept smaller incomes in exchange for a more equal distribution. An important feature of the Atkinson index is that it can be decomposed into within-group and between-group inequality.</td><td>Range <!-- -->[0, 1]<!-- -->. 0 if perfect equality. 1 means maximum inequality. In our case, it is the proportion of records for a sensitive columns‚Äô combination.</td><td><a href="https://en.wikipedia.org/wiki/Atkinson_index" target="_blank" rel="noopener noreferrer">Link</a></td></tr><tr><td>Theil T Index</td><td>GE(1) = Theil&#x27;s T and is more sensitive to differences at the top of the distribution. The Theil index is a statistic used to measure economic inequality. The Theil index measures an entropic &quot;distance&quot; the population is away from the &quot;ideal&quot; egalitarian state of everyone having the same income.</td><td>If everyone has the same income, then¬†T_T¬†equals¬†0. If one person has all the income, then¬†T_T¬†gives the result¬†(ln N).¬†0 means equal income and larger values mean higher level of disproportion.</td><td><a href="https://en.wikipedia.org/wiki/Theil_index" target="_blank" rel="noopener noreferrer">Link</a></td></tr><tr><td>Theil L Index</td><td>GE(0) = Theil&#x27;s L and is more sensitive to differences at the lower end of the distribution. Logarithm of (mean income)/(income i), over all the incomes included in the summation. It is also referred to as the mean log deviation measure. Because a transfer from a larger income to a smaller one will change the smaller income&#x27;s ratio more than it changes the larger income&#x27;s ratio, the transfer-principle is satisfied by this index.</td><td>Same interpretation as Theil T Index.</td><td><a href="https://en.wikipedia.org/wiki/Theil_index" target="_blank" rel="noopener noreferrer">Link</a></td></tr></tbody></table><h2 class="anchor anchorWithStickyNavbar_31ik" id="mitigation">Mitigation<a class="hash-link" href="#mitigation" title="Direct link to heading">‚Äã</a></h2><p>It will not be a stretch to say that every real-world dataset has caveats, biases, and imbalances. Data collection is costly. Data Imbalance mitigation or de-biasing data is an area of research. There are many techniques available at various stages of ML lifecycle i.e., during pre-processing, in-processing, and post processing. Here we outline a couple of pre-processing techniques -  </p><h3 class="anchor anchorWithStickyNavbar_31ik" id="resampling">Resampling<a class="hash-link" href="#resampling" title="Direct link to heading">‚Äã</a></h3><p>This involves under-sampling from majority class and over-sampling from minority class. Most na√Øve way to over-sample would be duplicate records and under-sample would be to remove records at random.  </p><ul><li><p>Caveats:  </p><ol><li>Under-sampling may remove valuable information.  </li><li>Over-sampling may cause overfitting and poor generalization on test set.</li></ol></li></ul><p><img src="https://mmlspark.blob.core.windows.net/graphics/responsible_ai/DataBalanceAnalysis_SamplingBar.png" alt="Bar chart undersampling and oversampling"></p><p>There are smarter techniques to under-sample and over-sample in literature and implemented in Python‚Äôs <a href="https://imbalanced-learn.org/stable/" target="_blank" rel="noopener noreferrer">imbalanced-learn</a> package.  </p><p>For example, we can cluster the records of the majority class, and do the under-sampling by removing records from each cluster, thus seeking to preserve information.  </p><p>One technique of under-sampling is use of Tomek Links. Tomek links are pairs of very close instances but of opposite classes. Removing the instances of the majority class of each pair increases the space between the two classes, facilitating the classification process. A similar way to under-sample majority class is using Near-Miss. It first calculates the distance between all the points in the larger class with the points in the smaller class. When two points belonging to different classes are very close to each other in the distribution, this algorithm eliminates the datapoint of the larger class thereby trying to balance the distribution.</p><p><img src="https://mmlspark.blob.core.windows.net/graphics/responsible_ai/DataBalanceAnalysis_TomekLinks.png" alt="Tomek Links"></p><p>In over-sampling, instead of creating exact copies of the minority class records, we can introduce small variations into those copies, creating more diverse synthetic samples. This technique is called SMOTE (Synthetic Minority Oversampling Technique). It randomly picks a point from the minority class and computes the k-nearest neighbors for this point. The synthetic points are added between the chosen point and its neighbors.</p><p><img src="https://mmlspark.blob.core.windows.net/graphics/responsible_ai/DataBalanceAnalysis_SyntheticSamples.png" alt="Synthetic Samples"></p><h3 class="anchor anchorWithStickyNavbar_31ik" id="reweighting">Reweighting<a class="hash-link" href="#reweighting" title="Direct link to heading">‚Äã</a></h3><p>There is an expected and observed value in each table cell. The weight is essentially expected / observed value. This is easy to extend to multiple features with more than 2 groups. The weights are then incorporated in loss function of model training.  </p><p><img src="https://mmlspark.blob.core.windows.net/graphics/responsible_ai/DataBalanceAnalysis_Reweight.png" alt="Reweighting"></p></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/SynapseML/docs/0.9.4/features/cognitive_services/CognitiveServices - Predictive Maintenance/"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">CognitiveServices - Predictive Maintenance</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/SynapseML/docs/0.9.4/features/responsible_ai/DataBalanceAnalysis - Adult Census Income/"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">DataBalanceAnalysis - Adult Census Income</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#context" class="table-of-contents__link toc-highlight">Context</a></li><li><a href="#examples" class="table-of-contents__link toc-highlight">Examples</a></li><li><a href="#usage" class="table-of-contents__link toc-highlight">Usage</a></li><li><a href="#measure-explanations" class="table-of-contents__link toc-highlight">Measure Explanations</a><ul><li><a href="#feature-balance-measures" class="table-of-contents__link toc-highlight">Feature Balance Measures</a></li><li><a href="#distribution-balance-measures" class="table-of-contents__link toc-highlight">Distribution Balance Measures</a></li><li><a href="#aggregate-balance-measures" class="table-of-contents__link toc-highlight">Aggregate Balance Measures</a></li></ul></li><li><a href="#mitigation" class="table-of-contents__link toc-highlight">Mitigation</a><ul><li><a href="#resampling" class="table-of-contents__link toc-highlight">Resampling</a></li><li><a href="#reweighting" class="table-of-contents__link toc-highlight">Reweighting</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/SynapseML/docs/getting_started/installation/">Installation</a></li><li class="footer__item"><a class="footer__link-item" href="/SynapseML/docs/getting_started/first_example/">Getting Started</a></li><li class="footer__item"><a href="https://mmlspark.blob.core.windows.net/docs/0.9.5/pyspark/index.html" target="_blank" rel="noopener noreferrer" class="footer__link-item">Python API Reference</a></li><li class="footer__item"><a href="https://mmlspark.blob.core.windows.net/docs/0.9.5/scala/index.html" target="_blank" rel="noopener noreferrer" class="footer__link-item">Scala API Reference</a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/SynapseML/blog/">Blog</a></li><li class="footer__item"><a class="footer__link-item" href="/SynapseML/videos/">Videos</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items"><li class="footer__item"><a href="https://github.com/microsoft/SynapseML" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright ¬© 2022 Microsoft.</div></div></div></footer></div>
<script src="/SynapseML/assets/js/runtime~main.dc11f221.js"></script>
<script src="/SynapseML/assets/js/main.a6a41b46.js"></script>
</body>
</html>