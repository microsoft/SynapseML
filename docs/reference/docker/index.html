<!doctype html>
<html class="docs-version-0.9.1" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.7">
<link rel="alternate" type="application/rss+xml" href="/SynapseML/blog/rss.xml" title="Synapse ML RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/SynapseML/blog/atom.xml" title="Synapse ML Atom Feed"><title data-react-helmet="true">Using the MMLSpark Docker Image | Synapse ML</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://microsoft.github.io/SynapseML/docs/reference/docker/"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="0.9.1"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-0.9.1"><meta data-react-helmet="true" property="og:title" content="Using the MMLSpark Docker Image | Synapse ML"><meta data-react-helmet="true" name="description" content="Using the MMLSpark Docker Image"><meta data-react-helmet="true" property="og:description" content="Using the MMLSpark Docker Image"><link data-react-helmet="true" rel="shortcut icon" href="/SynapseML/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://microsoft.github.io/SynapseML/docs/reference/docker/"><link data-react-helmet="true" rel="alternate" href="https://microsoft.github.io/SynapseML/docs/reference/docker/" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://microsoft.github.io/SynapseML/docs/reference/docker/" hreflang="x-default"><link rel="stylesheet" href="/SynapseML/assets/css/styles.d86f4755.css">
<link rel="preload" href="/SynapseML/assets/js/runtime~main.a5023bb5.js" as="script">
<link rel="preload" href="/SynapseML/assets/js/main.30b37f1a.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"dark")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_1boX">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/SynapseML/"><div class="navbar__logo"><img src="/SynapseML/img/logo.svg" alt="SynapseML Logo" class="themedImage_3oOy themedImage--light_3ouy"><img src="/SynapseML/img/logo.svg" alt="SynapseML Logo" class="themedImage_3oOy themedImage--dark_3zJb"></div><b class="navbar__title">SynapseML</b></a><a class="navbar__item navbar__link" href="/SynapseML/docs/about/">Docs</a><a class="navbar__item navbar__link" href="/SynapseML/blog/">Blog</a><a class="navbar__item navbar__link" href="/SynapseML/videos/">Videos</a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a class="navbar__link" href="/SynapseML/docs/about/">0.9.1</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/SynapseML/docs/next/reference/docker/">Next</a></li><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/SynapseML/docs/reference/docker/">0.9.1</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" class="navbar__link"><span><svg viewBox="0 0 20 20" width="20" height="20" aria-hidden="true" class="iconLanguage_tswG"><path fill="currentColor" d="M19.753 10.909c-.624-1.707-2.366-2.726-4.661-2.726-.09 0-.176.002-.262.006l-.016-2.063 3.525-.607c.115-.019.133-.119.109-.231-.023-.111-.167-.883-.188-.976-.027-.131-.102-.127-.207-.109-.104.018-3.25.461-3.25.461l-.013-2.078c-.001-.125-.069-.158-.194-.156l-1.025.016c-.105.002-.164.049-.162.148l.033 2.307s-3.061.527-3.144.543c-.084.014-.17.053-.151.143.019.09.19 1.094.208 1.172.018.08.072.129.188.107l2.924-.504.035 2.018c-1.077.281-1.801.824-2.256 1.303-.768.807-1.207 1.887-1.207 2.963 0 1.586.971 2.529 2.328 2.695 3.162.387 5.119-3.06 5.769-4.715 1.097 1.506.256 4.354-2.094 5.98-.043.029-.098.129-.033.207l.619.756c.08.096.206.059.256.023 2.51-1.73 3.661-4.515 2.869-6.683zm-7.386 3.188c-.966-.121-.944-.914-.944-1.453 0-.773.327-1.58.876-2.156a3.21 3.21 0 011.229-.799l.082 4.277a2.773 2.773 0 01-1.243.131zm2.427-.553l.046-4.109c.084-.004.166-.01.252-.01.773 0 1.494.145 1.885.361.391.217-1.023 2.713-2.183 3.758zm-8.95-7.668a.196.196 0 00-.196-.145h-1.95a.194.194 0 00-.194.144L.008 16.916c-.017.051-.011.076.062.076h1.733c.075 0 .099-.023.114-.072l1.008-3.318h3.496l1.008 3.318c.016.049.039.072.113.072h1.734c.072 0 .078-.025.062-.076-.014-.05-3.083-9.741-3.494-11.04zm-2.618 6.318l1.447-5.25 1.447 5.25H3.226z"></path></svg><span>English</span></span></a><ul class="dropdown__menu"><li><a href="/SynapseML/docs/reference/docker/" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" style="text-transform:capitalize">English</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a class="navbar__link">Developer Docs</a><ul class="dropdown__menu"><li><a href="https://mmlspark.blob.core.windows.net/docs/0.9.1/pyspark/index.html" target="_blank" rel="noopener noreferrer" class="dropdown__link"><span>Python<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_37dV"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li><a href="https://mmlspark.blob.core.windows.net/docs/0.9.1/scala/com/microsoft/azure/synapse/ml/index.html" target="_blank" rel="noopener noreferrer" class="dropdown__link"><span>Scala<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_37dV"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><a href="https://github.com/microsoft/SynapseML" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link" aria-label="GitHub repository"></a><div class="toggle_2iFN toggle_2ySP toggleChecked_XXXW toggleDisabled_1pbd"><div class="toggleTrack_1bVV" role="button" tabindex="-1"><div class="toggleTrackCheck_3GBG"><span class="toggleIcon_KBSf">ðŸŒœ</span></div><div class="toggleTrackX_1jae"><span class="toggleIcon_KBSf">ðŸŒž</span></div><div class="toggleTrackThumb_2_QT"></div></div><input type="checkbox" checked="" class="toggleScreenReader_32DE" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_3zOJ"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_DkI0" type="button"></button><aside class="docSidebarContainer_G8MK"><div class="sidebar_1tWv"><nav class="menu thin-scrollbar menu_1Iah"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/SynapseML/docs/about/">Introduction</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Getting Started</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Features</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Examples</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Transformers</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Estimators</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#">Reference</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/SynapseML/docs/reference/developer-readme/">Build System Commands</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/SynapseML/docs/reference/contributing_guide/">Contributing Guide</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/SynapseML/docs/reference/docker/">Docker Image</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/SynapseML/docs/reference/R-setup/">R setup</a></li></ul></li></ul></nav></div></aside><main class="docMainContainer_3Zec"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_2q91"><div class="docItemContainer_37q2"><article><span class="theme-doc-version-badge badge badge--secondary">Version: <!-- -->0.9.1</span><div class="tocCollapsible_3moT theme-doc-toc-mobile tocMobile_2bxg"><button type="button" class="clean-btn tocCollapsibleButton_3OYu">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Using the MMLSpark Docker Image</h1></header><h2 class="anchor anchorWithStickyNavbar_1iPN" id="quickstart-install-and-run-the-docker-image">Quickstart: install and run the Docker image<a aria-hidden="true" class="hash-link" href="#quickstart-install-and-run-the-docker-image" title="Direct link to heading">â€‹</a></h2><p>Begin by installing <a href="http://www.docker.com/products/overview/" target="_blank" rel="noopener noreferrer">Docker for your OS</a>.  Then, to get the
SynapseML image and run it, open a terminal (powershell/cmd on Windows) and run</p><div class="codeBlockContainer_21wf"><div class="codeBlockContent_1izB bash"><pre tabindex="0" class="prism-code language-bash codeBlock_1uaJ thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_3_dS"><span class="token-line" style="color:#f8f8f2"><span class="token plain">docker run -it -p </span><span class="token number" style="color:rgb(174, 129, 255)">8888</span><span class="token plain">:8888 mcr.microsoft.com/mmlspark/release</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_3XUZ clean-btn">Copy</button></div></div><p>In your browser, go to <a href="http://localhost:8888/" target="_blank" rel="noopener noreferrer">http://localhost:8888/</a> â€” you&#x27;ll see the Docker image
EULA, and once you accept it, the Jupyter notebook interface will start.  To
skip this step, add <code>-e ACCEPT_EULA=yes</code> to the Docker command:</p><div class="codeBlockContainer_21wf"><div class="codeBlockContent_1izB bash"><pre tabindex="0" class="prism-code language-bash codeBlock_1uaJ thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_3_dS"><span class="token-line" style="color:#f8f8f2"><span class="token plain">docker run -it -p </span><span class="token number" style="color:rgb(174, 129, 255)">8888</span><span class="token plain">:8888 -e </span><span class="token assign-left variable" style="color:rgb(248, 248, 242)">ACCEPT_EULA</span><span class="token operator">=</span><span class="token plain">y mcr.microsoft.com/mmlspark/release</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_3XUZ clean-btn">Copy</button></div></div><p>You can now select one of the sample notebooks and run it, or create your own.</p><blockquote><p>Note: The EULA is needed only for running the SynapseML Docker image; the
source code is released under the MIT license (see the <a href="https://github.com/microsoft/SynapseML/blob/master/LICENSE" target="_blank" rel="noopener noreferrer">LICENSE</a>
file).</p></blockquote><h2 class="anchor anchorWithStickyNavbar_1iPN" id="running-a-specific-version">Running a specific version<a aria-hidden="true" class="hash-link" href="#running-a-specific-version" title="Direct link to heading">â€‹</a></h2><p>In the above, <code>mcr.microsoft.com/mmlspark/release</code> specifies the project and image name that you
want to run.  There is another component implicit here which is the <em>tsag</em> (=
version) that you want to use â€” specifying it explicitly looks like
<code>mcr.microsoft.com/mmlspark/release:0.9.1</code> for the <code>0.9.1</code> tag.</p><p>Leaving <code>mcr.microsoft.com/mmlspark/release</code> by itself has an implicit <code>latest</code> tag, so it is
equivalent to <code>mcr.microsoft.com/mmlspark/release:latest</code>.  The <code>latest</code> tag is identical to the
most recent stable SynapseML version.  You can see the current <!-- -->[synapsemltags]<!-- --> on
our <a href="https://hub.docker.com/r/microsoft/mmlspark/" target="_blank" rel="noopener noreferrer">Docker Hub repository</a>.</p><h2 class="anchor anchorWithStickyNavbar_1iPN" id="a-more-practical-example">A more practical example<a aria-hidden="true" class="hash-link" href="#a-more-practical-example" title="Direct link to heading">â€‹</a></h2><p>The previous section had a rather simplistic command.  A more complete command
that you will probably want to use can look as follows:</p><div class="codeBlockContainer_21wf"><div class="codeBlockContent_1izB bash"><pre tabindex="0" class="prism-code language-bash codeBlock_1uaJ thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_3_dS"><span class="token-line" style="color:#f8f8f2"><span class="token plain">docker run -it --rm </span><span class="token punctuation" style="color:rgb(249, 38, 114)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">           -p </span><span class="token number" style="color:rgb(174, 129, 255)">127.0</span><span class="token plain">.0.1:80:8888 </span><span class="token punctuation" style="color:rgb(249, 38, 114)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">           -v ~/myfiles:/notebooks/myfiles </span><span class="token punctuation" style="color:rgb(249, 38, 114)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">           mcr.microsoft.com/mmlspark/release:0.9.1</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_3XUZ clean-btn">Copy</button></div></div><p>In this example, backslashes are used to break things up for readability; you
can enter it as one long like.  Note that in powershell, the <code>myfiles</code> local
path and line breaks looks a little different:</p><div class="codeBlockContainer_21wf"><div class="codeBlockContent_1izB"><pre tabindex="0" class="prism-code language-undefined codeBlock_1uaJ thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_3_dS"><span class="token-line" style="color:#f8f8f2"><span class="token plain">docker run -it --rm `</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">           -p 127.0.0.1:80:8888 `</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">           -v C:\myfiles:/notebooks/myfiles `</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">           mcr.microsoft.com/mmlspark/release:0.9.1</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_3XUZ clean-btn">Copy</button></div></div><p>Let&#x27;s break this command and go over the meaning of each part:</p><ul><li><p><strong><code>-it</code></strong></p><p>This is a combination of <code>-i</code> and <code>-t</code> (which could also be specified as
<code>--interactive --tty</code>).  The combination of these two flags mean that the
image is running interactively, which in this example means that you can see
messages that the server prints out, and it also makes it possible to use
<code>Ctrl+C</code> to shut down the Jupyter notebook server.</p></li><li><p><strong><code>--rm</code></strong></p><p>When Docker runs any image, it creates a <em>container</em> to hold any additional
filesystem data for files that were created or modified.  If you ran the above
quickstart command, you can see the container that is left behind with <code>docker
container list -a</code>.  You can reclaim such containers with `docker container rm</p><id></id>`, or reclaim all containers from stopped run with `docker container prune`, or even more generally, reclaim all unused Docker resources with `docker system prune`.<p>Back to <code>--rm</code>: this flag tells Docker to discard the image when the image
exits.  You should be aware that this means that any data created while
running the image is discarded when the run is done â€” but see the description
of the <code>-v</code> flag below.</p></li><li><p><strong><code>-e ACCEPT_EULA=y</code></strong></p><p>The <code>-e</code> flag is used to set environment variables in the running container.
In this case, we use it to bypass the EULA check.  Additional flags can be
added for other variables, for example, you can add a <code>-e
MMLSPARK_JUPYTER_PORT=80</code> to change the port that the Jupyter server listens
to.</p></li><li><p><strong><code>-p 127.0.0.1:80:8888</code></strong></p><p>The Jupyter server in the SynapseML image listens to port 8888 â€” but that is
normally isolated from the actual network.  Previously, we have used <code>-p
8888:8888</code> to say that we want to map port 8888 (LHS) on our actual machine to
port 8888 (RHS) in the container.  One problem with this is that <code>8888</code> might
be hard to remember, but a more serious problem is that your machine now
serves the Jupyter interface to any one on your network.</p><p>This more complete example resolves these issues: we replaced <code>8888:8888</code> with
<code>80:8888</code> so HTTP port 80 goes to the container&#x27;s running Jupyter (making just
<a href="http://localhost/" target="_blank" rel="noopener noreferrer">http://localhost/</a> work); and we also added a <code>127.0.0.1:</code> prefix which means
that this is available only from your own machine rather than being exposed.</p><p>You can repeat this flag to forward additional ports similarly.  For example,
you can expose some of the <a href="https://spark.apache.org/docs/latest/security.html#configuring-ports-for-network-security" target="_blank" rel="noopener noreferrer">Spark ports</a>, e.g.,: <code>-p 127.0.0.1:4040:4040</code>.</p></li><li><p><strong><code>-v ~/myfiles:/notebooks/myfiles</code></strong></p><p>As described above, we&#x27;re using <code>--rm</code> to remove the container when the run
exits.  This is usually fine since pulling out files from these containers can
be a little complicated.  Instead, we use this flag to map a directory from
your machine (the <code>~/myfiles</code> on the LHS) to a directory that is available
inside the running container.  Any modifications to this directory that are
done by the Docker image are performed directly on the actual directory.</p><p>Note that the local directory follows the local filename conventions, so on
Windows you&#x27;d use a Windows-looking path.  On Windows you also need to share
the drive you want to use in the <a href="https://docs.docker.com/docker-for-windows/#docker-settings" target="_blank" rel="noopener noreferrer">Docker settings</a>.</p><p>The path on the right side is used inside the container and it is therefore a
Linux path.  The SynapseML image runs Jupyter in the <code>/notebooks</code> directory, so
it is a good place for making your files available conveniently.</p><p>This flag can be used more than once, to make several directories available in
the running container.  Both paths must be absolute, so if you want to specify
a path relatively, you can use something like <code>-v
$PWD/myfiles:/notebooks/myfiles</code>.</p><p>With such directory sharing in place, you can create/edit notebooks, and code
in notebooks can use the shared directory for additional data, for example:</p><div class="codeBlockContainer_21wf"><div class="codeBlockContent_1izB python"><pre tabindex="0" class="prism-code language-python codeBlock_1uaJ thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_3_dS"><span class="token-line" style="color:#f8f8f2"><span class="token plain">data </span><span class="token operator">=</span><span class="token plain"> spark</span><span class="token punctuation" style="color:rgb(249, 38, 114)">.</span><span class="token plain">read</span><span class="token punctuation" style="color:rgb(249, 38, 114)">.</span><span class="token plain">csv</span><span class="token punctuation" style="color:rgb(249, 38, 114)">(</span><span class="token string" style="color:rgb(230, 219, 116)">&#x27;myfiles/mydata.csv&#x27;</span><span class="token punctuation" style="color:rgb(249, 38, 114)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(249, 38, 114)">.</span><span class="token punctuation" style="color:rgb(249, 38, 114)">.</span><span class="token punctuation" style="color:rgb(249, 38, 114)">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">model</span><span class="token punctuation" style="color:rgb(249, 38, 114)">.</span><span class="token plain">write</span><span class="token punctuation" style="color:rgb(249, 38, 114)">(</span><span class="token punctuation" style="color:rgb(249, 38, 114)">)</span><span class="token punctuation" style="color:rgb(249, 38, 114)">.</span><span class="token plain">overwrite</span><span class="token punctuation" style="color:rgb(249, 38, 114)">(</span><span class="token punctuation" style="color:rgb(249, 38, 114)">)</span><span class="token punctuation" style="color:rgb(249, 38, 114)">.</span><span class="token plain">save</span><span class="token punctuation" style="color:rgb(249, 38, 114)">(</span><span class="token string" style="color:rgb(230, 219, 116)">&#x27;myfiles/myTrainedModel.mml&#x27;</span><span class="token punctuation" style="color:rgb(249, 38, 114)">)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_3XUZ clean-btn">Copy</button></div></div></li><li><p><strong><code>mcr.microsoft.com/mmlspark/release:0.9.1</code></strong></p><p>Finally, this specifies an explicit version tag for the image that we want to
run.</p></li></ul><h2 class="anchor anchorWithStickyNavbar_1iPN" id="running-the-container-as-a-server">Running the container as a server<a aria-hidden="true" class="hash-link" href="#running-the-container-as-a-server" title="Direct link to heading">â€‹</a></h2><p>An alternative to running the Docker image interactively with <code>-it</code> is running
it in a &quot;detached&quot; mode, as a server, using the <code>-d</code> (or <code>--detach</code>) flag.  An
additional flag that is useful for this is <code>--name</code> that gives a convenient
label to the running image:</p><div class="codeBlockContainer_21wf"><div class="codeBlockContent_1izB bash"><pre tabindex="0" class="prism-code language-bash codeBlock_1uaJ thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_3_dS"><span class="token-line" style="color:#f8f8f2"><span class="token plain">docker run -d --name my-synapseml </span><span class="token punctuation" style="color:rgb(249, 38, 114)">..</span><span class="token plain">.flags</span><span class="token punctuation" style="color:rgb(249, 38, 114)">..</span><span class="token plain">. mcr.microsoft.com/mmlspark/release</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_3XUZ clean-btn">Copy</button></div></div><p>When running in this mode, you can use</p><ul><li><p><code>docker stop my-synapseml</code>:  to stop the image</p></li><li><p><code>docker start my-synapseml</code>: to start it again</p></li><li><p><code>docker logs my-synapseml</code>:  to see the log output it produced</p></li></ul><h2 class="anchor anchorWithStickyNavbar_1iPN" id="running-other-commands-in-an-active-container">Running other commands in an active container<a aria-hidden="true" class="hash-link" href="#running-other-commands-in-an-active-container" title="Direct link to heading">â€‹</a></h2><p>Another useful <code>docker</code> command is <code>exec</code>, which runs a command in the context
of an <em>existing</em> active container.  To use it, you specify the container name,
and the command to run.  For example, with a detached container started as
above, you can use</p><div class="codeBlockContainer_21wf"><div class="codeBlockContent_1izB bash"><pre tabindex="0" class="prism-code language-bash codeBlock_1uaJ thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_3_dS"><span class="token-line" style="color:#f8f8f2"><span class="token plain">docker </span><span class="token builtin class-name" style="color:rgb(174, 129, 255)">exec</span><span class="token plain"> -it my-synapseml </span><span class="token function" style="color:rgb(166, 226, 46)">bash</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_3XUZ clean-btn">Copy</button></div></div><p>to start a shell in the context of the server, roughly equivalent to starting a
terminal in the Jupyter interface.</p><p>Other common Linux executables can be used, e.g.,</p><div class="codeBlockContainer_21wf"><div class="codeBlockContent_1izB bash"><pre tabindex="0" class="prism-code language-bash codeBlock_1uaJ thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_3_dS"><span class="token-line" style="color:#f8f8f2"><span class="token plain">docker </span><span class="token builtin class-name" style="color:rgb(174, 129, 255)">exec</span><span class="token plain"> -it my-synapseml </span><span class="token function" style="color:rgb(166, 226, 46)">top</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">docker </span><span class="token builtin class-name" style="color:rgb(174, 129, 255)">exec</span><span class="token plain"> my-synapseml </span><span class="token function" style="color:rgb(166, 226, 46)">ps</span><span class="token plain"> auxw</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_3XUZ clean-btn">Copy</button></div></div><p>(Note that <code>ps</code> does not need <code>-it</code> since it&#x27;s not an interactive command.)</p><p>These commands can be used with interactive containers too, and <code>--name</code> can be
used to make them easy to target.  If you don&#x27;t use <code>--name</code>, Docker assigns a
random name to the container; you can use <code>docker ps</code> to see it --- and you can
also get the container IDs and use those instead of names.</p><p>Remember that the command given to <code>docker exec</code> is running in the context of
the running container: you can only run executables that exist in the container,
and the run is subject to the same resource restrictions (FS/network access,
etc) as the container.  The SynapseML image is based on a rather basic Ubuntu
installation (the <code>ubuntu</code> image from Docker Hub).</p><h2 class="anchor anchorWithStickyNavbar_1iPN" id="running-other-spark-executables">Running other Spark executables<a aria-hidden="true" class="hash-link" href="#running-other-spark-executables" title="Direct link to heading">â€‹</a></h2><p><code>docker run</code> can accept another optional argument after the image name,
specifying an alternative executable to run instead of the default launcher that
fires up the Jupyter notebook server.  This makes it possible to use the Spark
environment directly in the container if you start it as:</p><div class="codeBlockContainer_21wf"><div class="codeBlockContent_1izB bash"><pre tabindex="0" class="prism-code language-bash codeBlock_1uaJ thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_3_dS"><span class="token-line" style="color:#f8f8f2"><span class="token plain">docker run -it </span><span class="token punctuation" style="color:rgb(249, 38, 114)">..</span><span class="token plain">.flags</span><span class="token punctuation" style="color:rgb(249, 38, 114)">..</span><span class="token plain">. mcr.microsoft.com/mmlspark/release </span><span class="token function" style="color:rgb(166, 226, 46)">bash</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_3XUZ clean-btn">Copy</button></div></div><p>This starts the container with bash instead of Jupyter.  This environment has
all of the Spark executables available in its <code>$PATH</code>.  You still need to
specify the command-line flags that load the SynapseML package, but there are
convenient environment variables that hold the required package and repositories
to use:</p><div class="codeBlockContainer_21wf"><div class="codeBlockContent_1izB bash"><pre tabindex="0" class="prism-code language-bash codeBlock_1uaJ thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_3_dS"><span class="token-line" style="color:#f8f8f2"><span class="token plain">pyspark --repositories </span><span class="token string" style="color:rgb(230, 219, 116)">&quot;</span><span class="token string variable" style="color:rgb(248, 248, 242)">$MML_M2REPOS</span><span class="token string" style="color:rgb(230, 219, 116)">&quot;</span><span class="token plain"> --packages </span><span class="token string" style="color:rgb(230, 219, 116)">&quot;</span><span class="token string variable" style="color:rgb(248, 248, 242)">$MML_PACKAGE</span><span class="token string" style="color:rgb(230, 219, 116)">&quot;</span><span class="token plain"> --master </span><span class="token string" style="color:rgb(230, 219, 116)">&quot;local[*]&quot;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_3XUZ clean-btn">Copy</button></div></div><p>Many of the above listed flags are useful in this case too, such as mapping work
directories with <code>-v</code>.</p><h2 class="anchor anchorWithStickyNavbar_1iPN" id="updating-the-synapseml-image">Updating the SynapseML image<a aria-hidden="true" class="hash-link" href="#updating-the-synapseml-image" title="Direct link to heading">â€‹</a></h2><p>New releases of SynapseML are published from time to time, and they include a new
Docker image.  As an image consumer, you will normlly not notice such new
versions: <code>docker run</code> will download an image if a copy of it does not exist
locally, but if it does, then <code>docker run</code> will blindly run it, <em>without</em>
checking for new tags that were pushed.</p><p>This means that you need to explicitly tell Docker to check for a new version
and pull it if one exists.  You do this with the <code>pull</code> command:</p><div class="codeBlockContainer_21wf"><div class="codeBlockContent_1izB bash"><pre tabindex="0" class="prism-code language-bash codeBlock_1uaJ thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_3_dS"><span class="token-line" style="color:#f8f8f2"><span class="token plain">docker pull mcr.microsoft.com/mmlspark/release</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_3XUZ clean-btn">Copy</button></div></div><p>Since we didn&#x27;t specify an explicit tag here, <code>docker</code> adds the implied
<code>:latest</code> tag, and checks the available <code>mcr.microsoft.com/mmlspark/release</code> image with this tag
on Docker Hub.  When it finds a different image with this tag, it will fetch a
copy to your machine, changing the image that an unqualified
<code>mcr.microsoft.com/mmlspark/release</code> refers to.</p><p>Docker normally knows only about the tags that it fetched, so if you&#x27;ve always
used <code>mcr.microsoft.com/mmlspark/release</code> to refer to the image without an explicit version tag,
then you wouldn&#x27;t have the version-tagged image too.  Once the tag is updated,
the previous version will still be in your system, only without any tag.  Using
<code>docker images</code> to list the images in your system will now show you two images
for <code>mcr.microsoft.com/mmlspark/release</code>, one with a tag of <code>latest</code> and one with no tag, shown
as <code>&lt;none&gt;</code>.  Assuming that you don&#x27;t have active containers (including detached
ones), <code>docker system prune</code> will remove this untagged image, reclaiming the
used space.</p><p>If you have used an explicit version tag, then it will still exist after a new
pull, which means that you can continue using this version.  Note that if you
used an unqualified name first and then a version-tagged one, Docker will fetch
both tags, only the second fetch is fast since the it points to contents that
was already loaded.  In this case, doing a <code>pull</code> when there&#x27;s a new version
will fetch the new <code>latest</code> tag and change its meaning to the newer version, but
the older version will still be available under its own version tag.</p><p>Finally, if there are such version-tagged older versions that you want to get
rid of, you can use <code>docker images</code> to check the list of installed images and
their tags, and <code>docker rmi &lt;name&gt;:&lt;tag&gt;</code> to remove the unwanted ones.</p><h2 class="anchor anchorWithStickyNavbar_1iPN" id="a-note-about-security">A note about security<a aria-hidden="true" class="hash-link" href="#a-note-about-security" title="Direct link to heading">â€‹</a></h2><p>Executing code in a Docker container can be unsafe if the running user is
<code>root</code>.  For this reason, the SynapseML image uses a proper username instead.  If
you still want to run as root (e.g., if you want to <code>apt install</code> an additional
ubuntu package), then you should use <code>--user root</code>.  This can be useful when
combined with <code>docker exec</code> too do such administrative work while the image
continues to run as usual.</p><h2 class="anchor anchorWithStickyNavbar_1iPN" id="further-reading">Further reading<a aria-hidden="true" class="hash-link" href="#further-reading" title="Direct link to heading">â€‹</a></h2><p>This text covers very briefly some of the useful things that you can do with the
SynapseML Docker image (and other images in general).  You can find much more
documentation <a href="https://docs.docker.com/" target="_blank" rel="noopener noreferrer">online</a>.</p></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/SynapseML/docs/reference/contributing_guide/"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« <!-- -->Contributing Guide</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/SynapseML/docs/reference/R-setup/"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">R setup<!-- --> Â»</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_2pwG thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#quickstart-install-and-run-the-docker-image" class="table-of-contents__link toc-highlight">Quickstart: install and run the Docker image</a></li><li><a href="#running-a-specific-version" class="table-of-contents__link toc-highlight">Running a specific version</a></li><li><a href="#a-more-practical-example" class="table-of-contents__link toc-highlight">A more practical example</a></li><li><a href="#running-the-container-as-a-server" class="table-of-contents__link toc-highlight">Running the container as a server</a></li><li><a href="#running-other-commands-in-an-active-container" class="table-of-contents__link toc-highlight">Running other commands in an active container</a></li><li><a href="#running-other-spark-executables" class="table-of-contents__link toc-highlight">Running other Spark executables</a></li><li><a href="#updating-the-synapseml-image" class="table-of-contents__link toc-highlight">Updating the SynapseML image</a></li><li><a href="#a-note-about-security" class="table-of-contents__link toc-highlight">A note about security</a></li><li><a href="#further-reading" class="table-of-contents__link toc-highlight">Further reading</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/SynapseML/docs/getting_started/installation/">Installation</a></li><li class="footer__item"><a class="footer__link-item" href="/SynapseML/docs/getting_started/first_example/">Getting Started</a></li><li class="footer__item"><a href="https://mmlspark.blob.core.windows.net/docs/0.9.1/pyspark/index.html" target="_blank" rel="noopener noreferrer" class="footer__link-item">Python API Reference</a></li><li class="footer__item"><a href="https://mmlspark.blob.core.windows.net/docs/0.9.1/scala/index.html" target="_blank" rel="noopener noreferrer" class="footer__link-item">Scala API Reference</a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/SynapseML/blog/">Blog</a></li><li class="footer__item"><a class="footer__link-item" href="/SynapseML/videos/">Videos</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items"><li class="footer__item"><a href="https://github.com/microsoft/SynapseML" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_37dV"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2021 Microsoft.</div></div></div></footer></div>
<script src="/SynapseML/assets/js/runtime~main.a5023bb5.js"></script>
<script src="/SynapseML/assets/js/main.30b37f1a.js"></script>
</body>
</html>