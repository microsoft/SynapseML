name: Clean ACR
on: workflow_dispatch
jobs:
  clean-acr:
     name: Clean ACR
     runs-on: ubuntu-latest
     steps:
       - name: Azure Login
         uses: azure/login@v1
         with:
           creds: ${{ secrets.clean_acr }}
       - name: Get connection string    
         uses: Azure/CLI@v1
         with:
           inlineScript: |
             echo connection_string=$(az keyvault secret show -vault-name mmlspark-keys --name clean-acr-connection-string) --query >> $GITHUB_ENV
       - name: checkout repo content
         uses: actions/checkout@v2 # checkout the repo
       - name: setup python
         uses: actions/setup-python@v4
         with:
           python-version: '3.x'
       - run: pip install azure-storage-blob azure-identity tqdm
       - name: display
         run: echo ${{ env.connection_string }}
         shell: sh       
       - name: execute clean acr
         run: python .github/workflows/scripts/clean-acr.py ${{ env.connection_string }}
         shell: sh