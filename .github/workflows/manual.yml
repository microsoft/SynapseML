# Prerequisites:
# - Create a secret with your PAT token. Permissions needed: repo (all) and read:org
# - Create the HELLO_WORLD secret in your environment with some dummy initial value
# 
# Notes:
# - You can tell that it works because it masks the secret_body in the echo secret step after it creates the secret
# - If you don't want to have to pass --repo to gh secret set, then put the actions/checkout@v2 step before the gh secret set step

name: gh-set-secret4

on:
  workflow_dispatch:
  
env:
  SS_TOKEN: ${{ secrets.SS_PAT }}  # Permissions: repo (all) and read:org
  secret_name: HELLO_WORLD
  secret_body: "Hello World!"

jobs:
#  gh-set-secret:
#    runs-on: ubuntu-latest
#    steps:
#      - name: gh auth login
#        shell: bash
#        run: echo $SS_TOKEN | gh auth login --with-token
#      - name: gh secret set env
#        shell: bash
#        run: |
#          repository='${{ github.repository }}'
#          gh secret set "$secret_name" --body "$secret_body" --repo $repository
  gh-test-secret:
    #needs: [gh-set-secret]
    runs-on: ubuntu-latest
    environment:
      name: sandbox
    env:
      secret: ${{ secrets.HELLO_WORLD }}
    steps:
      - name: gh auth login
        shell: bash
        run: echo $SS_TOKEN | gh auth login --with-token
      - name: echo secret
        shell: bash
        run: |
          echo "Secret: $secret"
